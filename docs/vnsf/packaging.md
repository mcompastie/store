
> work in progress


# vNSF Packaging

## Contents

The SHIELD vNSF package extends the OSM VNF package definition by adding the security details. The SHIELD vNSF package is thus a wrapper that contains the following elements, marked as *(M)*andatory or *(O)*ptional:

Element | Contents | Source
-|-|-
manifest.yaml | (M) package contents definition along with the security information | SHIELD
*&lt;vnf_name\>*_vnfd.yaml | (M) vNSF descriptor information. Follows the [OSM Information Model](https://osm.etsi.org/wikipub/images/0/0c/Osm-r1-information-model-descriptors.pdf) (page 47) | OSM
charms | (O) [juju charm](https://jujucharms.com/) configuration for the VNF | OSM
checksums.txt | (M) image file(s) hash(es) | SHIELD
cloud_init | (O) instantiation configurations | OSM
icons | (O) used on the OSM Composer | OSM
images | (O) VDU image files for the vNSF | OSM
README | (O) vNSF related information | OSM
scripts | (O) base configuration scripts once the vNSF is up and running | OSM

The structure of a SHIELD vNSF package is as follows:

```bash
.
├── manifest.yaml           # SHIELD
└── <vnf_name>_vnfd         # OSM
    ├── charms              # OSM
    ├── checksums.txt       # SHIELD
    ├── cloud_init          # OSM
    ├── icons               # OSM
    ├── images              # OSM
    ├── README              # OSM
    ├── scripts             # OSM
    └── <vnf_name>.yaml     # OSM
```

## Data model

The contents of the two YAML files are described below:

### &lt;vnf_name\>.yaml

```yaml
vnfd:vnfd-catalog:
    vnfd:
    -   id: xpto_vnfd
        name: xpto_vnfd
        short-name: xpto_vnfd
        description: Generated by OSM pacakage generator
        vendor: OSM
        version: '1.0'

        # Place the logo as png in icons directory and provide the name here
        # logo: <update, optional>

        # Management interface
        mgmt-interface:
            vdu-id: xpto_vnfd-VM

        # Atleast one VDU need to be specified
        vdu:
        # Additional VDUs can be created by copying the
        # VDU descriptor below
        -   id: xpto_vnfd-VM
            name: xpto_vnfd-VM
            description: xpto_vnfd-VM
            count: 1

            # Flavour of the VM to be instantiated for the VDU
            vm-flavor:
                vcpu-count: 2
                memory-mb: 4096
                storage-gb: 10

            # Image including the full path
            image: '/path/to/img/file'

            external-interface:
            # Specify the external interfaces
            # There can be multiple interfaces defined
            -   name: eth0
                virtual-interface:
                    type: VIRTIO
                    bandwidth: '0'
                    vpci: '0000:00:0a.0'
                vnfd-connection-point-ref: eth0
            -   name: eth1
                virtual-interface:
                    type: VIRTIO
                    bandwidth: '0'
                    vpci: '0000:00:0b.0'
                vnfd-connection-point-ref: eth1

        connection-point:
            -   name: eth0
                type: VPORT
            -   name: eth1
                type: VPORT

        # Uncomment and update below to enable juju
        # charm configuration for the VNF
        # vnf-configuration:
        #     juju:
        #         charm: <charm name>
        #     service-primitive:
        #     -   name: config
        #         parameter:
        #         -   name: <config parameter>
        #             data-type: [STRING|INTEGER]
        #             mandatory: [true|false]
        #             default-value: <value>
        #     -   name: <action name>
        #         parameter:
        #         -   name: <action parameter>
        #             data-type: [STRING|INTEGER]
        #             mandatory: [true|false]
        #             default-value: <value>
        #     initial-config-primitive:
        #     -   name: config
        #         parameter:
        #         -   name: <config name>
        #             value: <value>
        #     -   name: <action name>
        #         parameter:
        #         -   name: <action parameter>
        #             value: <value>
```

### manifest.yaml

```yaml
manifest:vnsf:
    descriptor: xpto_vnfd/xpto_vnfd.yaml
    type: OSM
    state: sandboxed
    manifest_file: bWFuaWZlc3Q6dm5zZjoKICAgIGRlc2NyaXB0b3I6IHhwdG9fdm5mZC94cHRvX3ZuZmQueWFtbAog ICAgdHlwZTogT1NNCiAgICBzZWN1cml0eV9pbmZvOgogICAgICAgIHZkdToKICAgICAgICAgIC0g aWQ6IHhwdG9fdm5mZC1WTQogICAgICAgICAgICBoYXNoOiA3ZmI2OTNkZmQ5NWExNGRkNmVmNmRm ODM3Yzg3MjAyNwogICAgICAgICAgICBhdHRlc3RhdGlvbjoKICAgICAgICAgICAgICAgIHNvbWVr ZXk6IDxUQkQgLSBwcm92aWRlZCBieSBUTT4K
    security_info:
        vdu:
        -   id: xpto_vnfd-VM
            hash: 7fb693dfd95a14dd6ef6df837c872027
            attestation:
                key: <TBD - provided by TM>
    descriptor: """
        contents of xpto_vnfd.yaml
    """
```

## Generation

A SHIELD vNSF package can be generated by leveraging on the [OSM VNF packet generation](https://osm.etsi.org/wikipub/index.php/Creating_your_own_VNF_package_(Release_ONE&#40;), then adding the extra files introduced for the SHIELD vNSFs.

```bash
git clone https://osm.etsi.org/gerrit/osm/descriptor-packages
# Single-VM VNF package
./descriptor-packages/src/generate_descriptor_pkg.sh -t vnfd --image <IMAGE_PATH> -c <VNF_NAME>
# Edit YAML files to fit to the vNSF (adding VMs, VLDs, images, resources and so on)
# Define and customise the SHIELD vNSF manifest
touch manifest.yaml
# Provide the md5sum for each file in the SHIELD vNSF package
touch <VNF_NAME>_vnfd/checksums.txt
# Generate final .tar.gz
tar -zcvf <VNF_NAME>_vnfd.tar.gz <VNF_NAME>_vnfd manifest.yaml
```
